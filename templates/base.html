<!doctype html>
<html lang="en" class="dark">
    <head>
        <meta charset="utf-8" />
        <title>{% block title %}Candy Dash{% endblock %}</title>

        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <meta
            name="description"
            content="Candy sales route planning and management"
        />
        <meta name="theme-color" content="#0e1117" />

        <!-- Tailwind CDN -->
        <script src="https://cdn.tailwindcss.com"></script>
        <script>
            tailwind.config = {
                darkMode: "class",
                theme: {
                    extend: {
                        colors: {
                            app: "#0e1117",
                            sidebar: "#0b0f16",
                            card: "#1b1f2a",
                        },
                    },
                },
            };
        </script>

        {% block head %}{% endblock %}
    </head>

    <body class="bg-app text-gray-200 min-h-screen">
        <a
            href="#main-content"
            class="sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 focus:z-50 focus:px-4 focus:py-2 focus:bg-gray-800 focus:rounded-lg"
        >
            Skip to main content
        </a>

        <div class="flex min-h-screen">
            <!-- Sidebar -->
            <aside
                id="sidebar"
                class="fixed inset-y-0 left-0 z-40 w-64 bg-sidebar border-r border-gray-800 transform -translate-x-full md:translate-x-0 transition-transform duration-300 ease-in-out flex flex-col"
            >
                <div class="px-6 py-5 border-b border-gray-800">
                    <h1 class="text-xl font-bold tracking-tight">
                        üç¨ Candy Dash
                    </h1>
                    <p class="text-xs text-gray-500 mt-1">Route Planner</p>
                </div>

                <nav class="flex-1 px-4 py-6 space-y-1">
                    {% set ep = request.endpoint %} {% macro nav_item(endpoint,
                    label, icon) %}
                    <a
                        href="{{ url_for(endpoint) }}"
                        class="flex items-center gap-3 px-3 py-2 rounded-lg transition {% if ep == endpoint %}bg-gray-800 text-white {% else %}text-gray-300 hover:bg-gray-800{% endif %}"
                    >
                        {{ icon|safe }} {{ label }}
                    </a>
                    {% endmacro %} {{ nav_item( "dashboard.dashboard",
                    "Dashboard", '<svg
                        class="w-5 h-5"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                    >
                        <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M3 12l2-2 7-7 7 7v10a1 1 0 01-1 1h-3v-5a1 1 0 00-1-1h-2a1 1 0 00-1 1v5H6a1 1 0 01-1-1V10z"
                        /></svg
                    >' ) }} {{ nav_item("route.route", "Today's Route", '<svg
                        class="w-5 h-5"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                    >
                        <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M9 20l-5-2.7V5.6L9 7m0 13l6-3m-6 3V7m6 10l4 2.3V7.6L15 4"
                        /></svg
                    >' ) }} {{ nav_item("calendar.calendar", "Calendar", '<svg
                        class="w-5 h-5"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                    >
                        <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M8 7V3m8 4V3M5 11h14M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"
                        /></svg
                    >' ) }} {{ nav_item("customers.customers", "Customers",
                    '<svg
                        class="w-5 h-5"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                    >
                        <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M17 20h5v-2a3 3 0 00-5.4-1.9M7 20H2v-2a3 3 0 015.4-1.9M12 7a3 3 0 110-6 3 3 0 010 6z"
                        /></svg
                    >' ) }} {{ nav_item("balances.balances", "Balances", '<svg
                        class="w-5 h-5"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                    >
                        <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M12 8c-1.7 0-3 0.9-3 2s1.3 2 3 2 3 0.9 3 2-1.3 2-3 2m0-8V7m0 10v-1"
                        /></svg
                    >' ) }}
                </nav>

                <div
                    class="px-6 py-4 border-t border-gray-800 text-xs text-gray-500"
                >
                    ¬© {{ now.year }} Candy Dash
                </div>
            </aside>

            <!-- Overlay -->
            <div
                id="sidebar-overlay"
                class="fixed inset-0 bg-black/50 z-30 hidden md:hidden"
            ></div>

            <!-- Main -->
            <main class="flex-1 flex flex-col md:ml-64">
                <header
                    class="md:hidden flex items-center justify-between px-4 py-3 border-b border-gray-800 bg-gray-900 sticky top-0 z-20"
                >
                    <span class="font-semibold">üç¨ Candy Dash</span>
                    <button
                        id="mobile-menu-button"
                        class="p-2 rounded-lg hover:bg-gray-800"
                    >
                        ‚ò∞
                    </button>
                </header>

                {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                <div class="px-6 pt-4 space-y-2">
                    {% for category, message in messages %}
                    <div
                        class="rounded-lg px-4 py-3 text-sm {% if category == 'success' %}bg-green-500/15 text-green-400 {% elif category == 'error' %}bg-red-500/15 text-red-400 {% else %}bg-gray-800 text-gray-300{% endif %}"
                    >
                        {{ message }}
                    </div>
                    {% endfor %}
                </div>
                {% endif %} {% endwith %}

                <div id="main-content" class="flex-1 px-4 py-6 md:px-8 md:py-8">
                    {% block content %}{% endblock %}
                </div>
            </main>
        </div>

        <!-- HTMX and Alpine.js CDNs -->
        <script src="https://unpkg.com/htmx.org@2"></script>
        <script
            defer
            src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"
        ></script>

        <script src="{{ url_for('static', filename='js/app.js') }}"></script>

        <script>
            const btn = document.getElementById("mobile-menu-button");
            const sidebar = document.getElementById("sidebar");
            const overlay = document.getElementById("sidebar-overlay");

            function toggle() {
                sidebar.classList.toggle("-translate-x-full");
                sidebar.classList.toggle("translate-x-0");
                overlay.classList.toggle("hidden");
            }

            btn?.addEventListener("click", toggle);
            overlay?.addEventListener("click", toggle);
        </script>

        {% block scripts %}{% endblock %}
    </body>
</html>
