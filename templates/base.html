<!doctype html>
<html lang="en" class="dark">
    <head>
        <meta charset="utf-8" />
        <title>{% block title %}Candy Dash{% endblock %}</title>

        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <meta
            name="description"
            content="Candy sales route planning and management"
        />
        <meta name="theme-color" content="#0e1117" />

        <!-- Tailwind CDN -->
        <script src="https://cdn.tailwindcss.com"></script>
        <script>
            tailwind.config = {
                darkMode: "class",
                theme: {
                    extend: {
                        colors: {
                            app: {
                                bg: "#0e1117",
                                sidebar: "#0b0f16",
                                card: "#1b1f2a",
                                hover: "#252a38",
                                accent: "#3b82f6",
                                accentHover: "#2563eb",
                                danger: "#dc2626",
                                dangerSoft: "#7f1d1d",
                                success: "#16a34a",
                                warning: "#d97706",
                            },
                        },
                        borderRadius: {
                            card: "0.75rem",
                            modal: "1rem",
                            pill: "9999px",
                        },
                        boxShadow: {
                            card: "0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -1px rgba(0,0,0,0.06)",
                            elevated:
                                "0 10px 15px -3px rgba(0,0,0,0.1), 0 4px 6px -2px rgba(0,0,0,0.05)",
                        },
                    },
                },
            };
        </script>

        <!-- Custom Tailwind utilities -->
        <style type="text/tailwindcss">
            @layer utilities {
                .theme-card {
                    @apply bg-app-card border border-gray-800 rounded-card shadow-card overflow-hidden;
                }
                .theme-modal {
                    @apply bg-app-card border border-gray-700 rounded-modal shadow-elevated p-6 sm:p-8;
                }
                .theme-btn-primary {
                    @apply bg-app-accent hover:bg-app-accentHover text-white font-medium rounded-lg px-5 py-2.5 transition
                           focus:outline-none focus:ring-2 focus:ring-app-accent focus:ring-offset-2 focus:ring-offset-app-bg;
                }
                .theme-btn-secondary {
                    @apply bg-gray-800 hover:bg-gray-700 border border-gray-700 text-gray-200 font-medium rounded-lg px-5 py-2.5 transition;
                }
                .theme-btn-danger {
                    @apply bg-app-dangerSoft hover:bg-app-danger text-white font-medium rounded-lg px-5 py-2.5 transition;
                }
                .theme-input {
                    @apply w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-2.5 text-gray-200
                           placeholder-gray-500 focus:border-app-accent focus:ring-1 focus:ring-app-accent outline-none transition;
                }
                .theme-table-th {
                    @apply px-6 py-4 text-left text-xs font-semibold text-gray-400 uppercase tracking-wider bg-gray-900/70;
                }
                .theme-table-td {
                    @apply px-6 py-4 text-sm text-gray-300;
                }
                .theme-text-danger {
                    @apply text-red-400;
                }
                .theme-text-warning {
                    @apply text-amber-400;
                }
                .theme-text-success {
                    @apply text-green-400;
                }
            }
        </style>

        {% block head %}{% endblock %}
    </head>

    <body class="bg-app-bg text-gray-200 min-h-screen antialiased">
        <a
            href="#main-content"
            class="sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 focus:z-50 focus:px-4 focus:py-2 focus:bg-gray-800 focus:rounded-lg"
        >
            Skip to main content
        </a>

        <div class="flex min-h-screen">
            <!-- Sidebar -->
            <aside
                id="sidebar"
                class="fixed inset-y-0 left-0 z-40 w-64 bg-app-sidebar border-r border-gray-800 transform -translate-x-full md:translate-x-0 transition-transform duration-300 flex flex-col"
            >
                <div class="px-6 py-5 border-b border-gray-800">
                    <h1 class="text-xl font-bold tracking-tight">
                        üç¨ Candy Dash
                    </h1>
                    <p class="text-xs text-gray-500 mt-1">Route Planner</p>
                </div>

                <nav class="flex-1 px-4 py-6 space-y-1">
                    {% set ep = request.endpoint %} {% macro nav_item(endpoint,
                    label) %}
                    <a
                        href="{{ url_for(endpoint) }}"
                        class="flex items-center gap-3 px-3 py-2 rounded-lg transition {% if ep == endpoint %} bg-gray-800 text-white {% else %} text-gray-300 hover:bg-gray-800 {% endif %}"
                    >
                        {{ label }}
                    </a>
                    {% endmacro %} {{ nav_item("dashboard.dashboard",
                    "Dashboard") }} {{ nav_item("route.route", "Today's Route")
                    }} {{ nav_item("calendar.calendar", "Calendar") }} {{
                    nav_item("customers.customers", "Customers") }} {{
                    nav_item("balances.balances", "Balances") }}
                </nav>

                <div
                    class="px-6 py-4 border-t border-gray-800 text-xs text-gray-500"
                >
                    ¬© {{ now.year }} Candy Dash
                </div>
            </aside>

            <!-- Mobile overlay -->
            <div
                id="sidebar-overlay"
                class="fixed inset-0 bg-black/50 z-30 hidden md:hidden"
            ></div>

            <!-- Main -->
            <main class="flex-1 flex flex-col md:ml-64">
                <!-- Mobile header -->
                <header
                    class="md:hidden flex items-center justify-between px-4 py-3 border-b border-gray-800 bg-gray-900 sticky top-0 z-20"
                >
                    <span class="font-semibold">üç¨ Candy Dash</span>
                    <button
                        id="mobile-menu-button"
                        class="p-2 rounded-lg hover:bg-gray-800"
                        aria-label="Toggle menu"
                    >
                        ‚ò∞
                    </button>
                </header>

                <!-- Flash messages -->
                {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                <div class="px-6 pt-4 space-y-2">
                    {% for category, message in messages %}
                    <div
                        class="rounded-lg px-4 py-3 text-sm {% if category == 'success' %} bg-green-500/15 text-green-400 {% elif category == 'error' %} bg-red-500/15 text-red-400 {% else %} bg-gray-800 text-gray-300 {% endif %}"
                    >
                        {{ message }}
                    </div>
                    {% endfor %}
                </div>
                {% endif %} {% endwith %}

                <!-- Page content -->
                <div id="main-content" class="flex-1 px-4 py-6 md:px-8 md:py-8">
                    {% block content %}{% endblock %}
                </div>
            </main>
        </div>

        <!-- Libraries -->
        <script src="https://unpkg.com/htmx.org@2"></script>
        <script
            defer
            src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"
        ></script>
        <script src="{{ url_for('static', filename='js/app.js') }}"></script>

        <!-- Mobile sidebar toggle -->
        <script>
            const btn = document.getElementById("mobile-menu-button");
            const sidebar = document.getElementById("sidebar");
            const overlay = document.getElementById("sidebar-overlay");

            function toggleSidebar() {
                sidebar.classList.toggle("-translate-x-full");
                sidebar.classList.toggle("translate-x-0");
                overlay.classList.toggle("hidden");
            }

            btn?.addEventListener("click", toggleSidebar);
            overlay?.addEventListener("click", toggleSidebar);
        </script>

        {% block scripts %}{% endblock %}
    </body>
</html>
