{% extends "base.html" %} {% block title %}Calendar{% endblock %} {% block
content %}
<div class="max-w-6xl mx-auto space-y-10">
    <!-- Header -->
    <section>
        <h1 class="text-3xl font-bold">Calendar</h1>
        <p class="text-gray-400 mt-1">
            Plan routes, review upcoming visits, and add stops.
        </p>
    </section>

    <!-- Stats -->
    <section class="grid grid-cols-2 md:grid-cols-4 gap-4">
        <div class="bg-gray-900 border border-gray-800 rounded-xl p-4">
            <div class="text-xs text-gray-500">Visits this week</div>
            <div class="text-2xl font-bold">{{ visits_this_week }}</div>
        </div>
        <div class="bg-gray-900 border border-gray-800 rounded-xl p-4">
            <div class="text-xs text-gray-500">Visits this month</div>
            <div class="text-2xl font-bold">{{ visits_this_month }}</div>
        </div>
        <div class="bg-gray-900 border border-gray-800 rounded-xl p-4">
            <div class="text-xs text-gray-500">Avg / week</div>
            <div class="text-2xl font-bold">{{ avg_per_week }}</div>
        </div>
        <div class="bg-gray-900 border border-gray-800 rounded-xl p-4">
            <div class="text-xs text-gray-500">Completion rate</div>
            <div class="text-2xl font-bold">{{ completion_rate }}%</div>
        </div>
    </section>

    <!-- Quick Add -->
    <section class="bg-gray-900 border border-gray-800 rounded-2xl p-6">
        <h2 class="text-xl font-semibold mb-4">Add Customer to Route</h2>

        <form
            method="post"
            action="{{ url_for('route.route_add') }}"
            class="grid grid-cols-1 md:grid-cols-3 gap-4"
        >
            <select
                name="customer_id"
                required
                class="bg-gray-800 border border-gray-700 rounded-lg px-4 py-2"
            >
                <option value="">Select customer…</option>
                {% for c in all_customers %}
                <option value="{{ c.id }}">
                    {{ c.name }} {% if c.balance_cents > 0 %} — owes ${{
                    (c.balance_cents / 100) | round(2) }} {% endif %}
                </option>
                {% endfor %}
            </select>

            <input
                type="date"
                name="date"
                value="{{ today }}"
                class="bg-gray-800 border border-gray-700 rounded-lg px-4 py-2"
            />

            <button
                type="submit"
                class="bg-blue-600 hover:bg-blue-700 text-white rounded-lg px-4 py-2 font-medium"
            >
                Add to Route
            </button>
        </form>
    </section>

    <!-- Scheduled Routes -->
    <section>
        <h2 class="text-xl font-semibold mb-4">Scheduled Routes</h2>

        {% if scheduled_visits %}
        <div class="space-y-4">
            {% for date, visits in scheduled_visits.items() %}
            <div class="bg-gray-900 border border-gray-800 rounded-xl p-5">
                <div class="font-semibold mb-3">{{ date }}</div>
                <ul class="space-y-2">
                    {% for v in visits %}
                    <li class="flex justify-between text-sm">
                        <span>{{ v.customer_name }}</span>
                        {% if v.completed %}
                        <span class="text-green-400">✓</span>
                        {% endif %}
                    </li>
                    {% endfor %}
                </ul>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <p class="text-gray-500">No scheduled routes yet.</p>
        {% endif %}
    </section>
</div>
{% endblock %}
