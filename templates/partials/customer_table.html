<div
    class="theme-card overflow-hidden"
    x-data="customerTable"
    x-init="mode = '{{ mode }}'"
>
    <!-- Header -->
    <div class="p-6 border-b border-gray-800 flex justify-between gap-4">
        <h2 class="text-xl font-semibold">
            {{ 'Customer Balances' if mode == 'balances' else 'Customers' }}
        </h2>

        <input
            type="search"
            class="theme-input max-w-sm"
            placeholder="Search customers…"
            x-model="searchTerm"
        />
    </div>

    <!-- Table -->
    <div class="overflow-x-auto">
        <table class="min-w-full divide-y divide-gray-800 text-sm">
            <thead class="bg-gray-900/70">
                <tr>
                    <th
                        class="theme-table-th cursor-pointer"
                        @click="sortBy('name')"
                    >
                        Name <span x-text="sortIndicator('name')"></span>
                    </th>
                    <th class="theme-table-th">Address</th>
                    <th class="theme-table-th">Phone</th>
                    <th
                        class="theme-table-th cursor-pointer"
                        @click="sortBy('last_visit_at')"
                    >
                        Last Visited
                        <span x-text="sortIndicator('last_visit_at')"></span>
                    </th>
                    <th
                        class="theme-table-th text-right cursor-pointer"
                        @click="sortBy('balance')"
                    >
                        Balance <span x-text="sortIndicator('balance')"></span>
                    </th>
                </tr>
            </thead>

            <tbody>
                <template x-for="c in filteredRows" :key="c.id">
                    <tr class="hover:bg-gray-800/40">
                        <td class="theme-table-td">
                            <a
                                :href="`/customers/edit/${c.id}`"
                                class="text-app-accent"
                                x-text="c.name"
                            ></a>
                        </td>
                        <td
                            class="theme-table-td"
                            x-text="c.address || '—'"
                        ></td>
                        <td class="theme-table-td" x-text="c.phone || '—'"></td>
                        <td
                            class="theme-table-td"
                            x-text="c.last_visit_at || 'Never'"
                        ></td>
                        <td
                            class="theme-table-td text-right font-semibold"
                            :class="balanceClass(c.balance)"
                            x-text="'$' + Number(c.balance).toFixed(2)"
                        ></td>
                    </tr>
                </template>
            </tbody>
        </table>

        <p
            x-show="filteredRows.length === 0"
            class="py-12 text-center text-gray-500"
        >
            No customers found.
        </p>
    </div>
</div>
